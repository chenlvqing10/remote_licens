/*
 * Copyright (C) 2016-2018, LomboTech Co.Ltd.
 * Authors:
 *	lomboswer <lomboswer@lombotech.com>
 *
 * This program is free software; you can redistribute  it and/or modify it
 * under  the terms of  the GNU General  Public License as published by the
 * Free Software Foundation;  either version 2 of the  License, or (at your
 * option) any later version.
 */

#include <drm/drmP.h>
#include <drm/drm_panel.h>
#include "panel-simple.h"
#include "lombo_panel_config.h"

#define WKS43178_HBP		(20)
#define WKS43178_HFP		(40)
#define WKS43178_HSW		(10)
#define WKS43178_HACT		(800)
#define WKS43178_VBP		(10)
#define WKS43178_VFP		(15)
#define WKS43178_VSW		(10)
#define WKS43178_VACT		(480)
#define WKS43178_DCLK		(27000000)

#define HAS_VSYNC_CMD	(FALSE)
#define HAS_HSYNC_CMD	(FALSE)
#define CMD_ALIGN	(0)
#define HAS_TE		(FALSE)

#define DCS_MDELAY_FLAG (0)

static u32 gamma_tbl[256] = {
	/* red   power = 2.2 */
	/* green power = 1/2.2 */
	/* blue  power = 1.4 */
	0x000000, 0x001400, 0x001c00, 0x002100, 0x002600, 0x002a01, 0x002e01,
	0x003101, 0x003402, 0x003702, 0x003a02, 0x003d03, 0x003f03, 0x004203,
	0x004404, 0x004604, 0x004805, 0x004a05, 0x004c06, 0x004e06, 0x005007,
	0x015207, 0x015308, 0x015508, 0x015709, 0x015809, 0x015a0a, 0x015c0a,
	0x015d0b, 0x025f0c, 0x02600c, 0x02620d,	0x02630d, 0x02640e, 0x03660f,
	0x03670f, 0x036810, 0x036a11, 0x036b11, 0x046c12, 0x046e13, 0x046f13,
	0x047014, 0x057115, 0x057215, 0x057416, 0x057517, 0x067617, 0x067718,
	0x067819, 0x07791a, 0x077a1a, 0x077c1b, 0x087d1c, 0x087e1c, 0x087f1d,
	0x09801e, 0x09811f, 0x098220, 0x0a8320, 0x0a8421, 0x0a8522, 0x0b8623,
	0x0b8723, 0x0c8824, 0x0c8925, 0x0c8a26, 0x0d8b27, 0x0d8c28, 0x0e8d28,
	0x0e8d29, 0x0f8e2a, 0x0f8f2b, 0x10902c, 0x10912d, 0x11922d, 0x11932e,
	0x12942f, 0x129530, 0x139631, 0x139632, 0x149733, 0x149834, 0x159934,
	0x169a35, 0x169b36, 0x179b37, 0x179c38, 0x189d39, 0x199e3a, 0x199f3b,
	0x1a9f3c, 0x1aa03d, 0x1ba13e, 0x1ca23e, 0x1ca33f, 0x1da340, 0x1ea441,
	0x1ea542, 0x1fa643, 0x20a644, 0x21a745, 0x21a846, 0x22a947, 0x23a948,
	0x24aa49, 0x24ab4a, 0x25ac4b, 0x26ac4c, 0x27ad4d, 0x27ae4e, 0x28af4f,
	0x29af50, 0x2ab051, 0x2bb152, 0x2cb153, 0x2cb254, 0x2db355, 0x2eb456,
	0x2fb457, 0x30b558, 0x31b659, 0x32b65a, 0x33b75b, 0x33b85c, 0x34b85d,
	0x35b95e, 0x36ba5f, 0x37ba61, 0x38bb62, 0x39bc63, 0x3abc64, 0x3bbd65,
	0x3cbe66, 0x3dbe67, 0x3ebf68, 0x3fc069, 0x40c06a, 0x41c16b, 0x42c16c,
	0x43c26d, 0x44c36f, 0x46c370, 0x47c471,	0x48c572, 0x49c573, 0x4ac674,
	0x4bc675, 0x4cc776, 0x4dc877, 0x4ec879, 0x50c97a, 0x51c97b, 0x52ca7c,
	0x53cb7d, 0x54cb7e, 0x56cc7f, 0x57cc81, 0x58cd82, 0x59ce83, 0x5bce84,
	0x5ccf85, 0x5dcf86, 0x5ed088, 0x60d189, 0x61d18a, 0x62d28b, 0x64d28c,
	0x65d38d, 0x66d38f, 0x68d490, 0x69d591, 0x6ad592, 0x6cd693, 0x6dd695,
	0x6ed796, 0x70d797, 0x71d898, 0x73d999, 0x74d99b, 0x75da9c, 0x77da9d,
	0x78db9e, 0x7adba0, 0x7bdca1, 0x7ddca2, 0x7edda3, 0x80dda4, 0x81dea6,
	0x83dfa7, 0x84dfa8, 0x86e0a9, 0x87e0ab, 0x89e1ac, 0x8be1ad, 0x8ce2ae,
	0x8ee2b0, 0x8fe3b1, 0x91e3b2, 0x93e4b3, 0x94e4b5, 0x96e5b6, 0x98e5b7,
	0x99e6b9, 0x9be6ba, 0x9de7bb, 0x9ee7bc, 0xa0e8be, 0xa2e8bf, 0xa3e9c0,
	0xa5e9c2, 0xa7eac3, 0xa9eac4, 0xaaebc5, 0xacebc7, 0xaeecc8, 0xb0ecc9,
	0xb1edcb, 0xb3edcc, 0xb5eecd, 0xb7eecf, 0xb9efd0, 0xbbefd1, 0xbcf0d3,
	0xbef0d4, 0xc0f1d5, 0xc2f1d7, 0xc4f2d8, 0xc6f2d9, 0xc8f3db, 0xcaf3dc,
	0xccf4dd, 0xcef4df, 0xd0f5e0, 0xd2f5e1, 0xd4f6e3, 0xd6f6e4, 0xd8f7e5,
	0xdaf7e7, 0xdcf8e8, 0xdef8e9, 0xe0f9eb, 0xe2f9ec, 0xe4faed, 0xe6faef,
	0xe8faf0, 0xeafbf2, 0xecfbf3, 0xeefcf4, 0xf0fcf6, 0xf2fdf7, 0xf5fdf9,
	0xf7fefa, 0xf9fefb, 0xfbfffd, 0xfdfffe,
};

u32 init_code[] = {
	/********* Start Initial Sequence ******/
	/**********LV2 Page 1 enable************/
	2, 0xF000, 0x0055,
	2, 0xF001, 0x00AA,
	2, 0xF002, 0x0052,
	2, 0xF003, 0x0008,
	2, 0xF004, 0x0001,

	/************AVDD Set AVDD 5.2V*********/
	2, 0xB000, 0x000D,
	2, 0xB001, 0x000D,
	2, 0xB002, 0x000D,

	/***********AVDD ratio******************/
	2, 0xB600, 0x0034,
	2, 0xB601, 0x0034,
	2, 0xB602, 0x0034,

	/***********AVEE  -5.2V*****************/
	2, 0xB100, 0x000D,
	2, 0xB101, 0x000D,
	2, 0xB102, 0x000D,

	/**************AVEE ratio***************/
	2, 0xB700, 0x0034,
	2, 0xB701, 0x0034,
	2, 0xB702, 0x0034,

	/*************VCL  -2.5V*****************/
	2, 0xB200, 0x0000,
	2, 0xB201, 0x0000,
	2, 0xB202, 0x0000,

	/*************VCL ratio******************/
	2, 0xB800, 0x0024,
	2, 0xB801, 0x0024,
	2, 0xB802, 0x0024,

	/*************VGH 15V  (Free pump)********/
	2, 0xBF00, 0x0001,
	2, 0xB300, 0x000F,
	2, 0xB301, 0x000F,
	2, 0xB302, 0x000F,

	/**************VGH ratio******************/
	2, 0xB900, 0x0034,
	2, 0xB901, 0x0034,
	2, 0xB902, 0x0034,

	/**************VGL_REG -10V***************/
	2, 0xB500, 0x0008,
	2, 0xB501, 0x0008,
	2, 0xB502, 0x0008,

	2, 0xC200, 0x0003,

	/****************VGLX ratio***************/
	2, 0xBA00, 0x0024,
	2, 0xBA01, 0x0024,
	2, 0xBA02, 0x0024,

	/************VGMP/VGSP 4.5V/0V************/
	2, 0xBC00, 0x0000,
	2, 0xBC01, 0x0078,
	2, 0xBC02, 0x0000,

	/***********VGMN/VGSN -4.5V/0V************/
	2, 0xBD00, 0x0000,
	2, 0xBD01, 0x0078,
	2, 0xBD02, 0x0000,

	/***********VCOM  -1.25V******************/
	2, 0xBE00, 0x0000,
	2, 0xBE01, 0x0067,

	/***********Gamma Setting*****************/
	2, 0xD100, 0x0000,
	2, 0xD101, 0x0032,
	2, 0xD102, 0x0000,
	2, 0xD103, 0x0033,
	2, 0xD104, 0x0000,
	2, 0xD105, 0x0041,
	2, 0xD106, 0x0000,
	2, 0xD107, 0x005A,
	2, 0xD108, 0x0000,
	2, 0xD109, 0x0076,
	2, 0xD10A, 0x0000,
	2, 0xD10B, 0x00A7,
	2, 0xD10C, 0x0000,
	2, 0xD10D, 0x00CF,
	2, 0xD10E, 0x0001,
	2, 0xD10F, 0x0009,
	2, 0xD110, 0x0001,
	2, 0xD111, 0x0036,
	2, 0xD112, 0x0001,
	2, 0xD113, 0x0073,
	2, 0xD114, 0x0001,
	2, 0xD115, 0x009F,
	2, 0xD116, 0x0001,
	2, 0xD117, 0x00DF,
	2, 0xD118, 0x0002,
	2, 0xD119, 0x0010,
	2, 0xD11A, 0x0002,
	2, 0xD11B, 0x0011,
	2, 0xD11C, 0x0002,
	2, 0xD11D, 0x003D,
	2, 0xD11E, 0x0002,
	2, 0xD11F, 0x0069,
	2, 0xD120, 0x0002,
	2, 0xD121, 0x0081,
	2, 0xD122, 0x0002,
	2, 0xD123, 0x009D,
	2, 0xD124, 0x0002,
	2, 0xD125, 0x00AD,
	2, 0xD126, 0x0002,
	2, 0xD127, 0x00C3,
	2, 0xD128, 0x0002,
	2, 0xD129, 0x00D0,
	2, 0xD12A, 0x0002,
	2, 0xD12B, 0x00E2,
	2, 0xD12C, 0x0002,
	2, 0xD12D, 0x00EE,
	2, 0xD12E, 0x0003,
	2, 0xD12F, 0x0001,
	2, 0xD130, 0x0003,
	2, 0xD131, 0x0026,
	2, 0xD132, 0x0003,
	2, 0xD133, 0x008E,

	2, 0xD200, 0x0000,
	2, 0xD201, 0x0032,
	2, 0xD202, 0x0000,
	2, 0xD203, 0x0033,
	2, 0xD204, 0x0000,
	2, 0xD205, 0x0041,
	2, 0xD206, 0x0000,
	2, 0xD207, 0x005A,
	2, 0xD208, 0x0000,
	2, 0xD209, 0x0076,
	2, 0xD20A, 0x0000,
	2, 0xD20B, 0x00A7,
	2, 0xD20C, 0x0000,
	2, 0xD20D, 0x00CF,
	2, 0xD20E, 0x0001,
	2, 0xD20F, 0x0009,
	2, 0xD210, 0x0001,
	2, 0xD211, 0x0036,
	2, 0xD212, 0x0001,
	2, 0xD213, 0x0073,
	2, 0xD214, 0x0001,
	2, 0xD215, 0x009F,
	2, 0xD216, 0x0001,
	2, 0xD217, 0x00DF,
	2, 0xD218, 0x0002,
	2, 0xD219, 0x0010,
	2, 0xD21A, 0x0002,
	2, 0xD21B, 0x0011,
	2, 0xD21C, 0x0002,
	2, 0xD21D, 0x003D,
	2, 0xD21E, 0x0002,
	2, 0xD21F, 0x0069,
	2, 0xD220, 0x0002,
	2, 0xD221, 0x0081,
	2, 0xD222, 0x0002,
	2, 0xD223, 0x009D,
	2, 0xD224, 0x0002,
	2, 0xD225, 0x00AD,
	2, 0xD226, 0x0002,
	2, 0xD227, 0x00C3,
	2, 0xD228, 0x0002,
	2, 0xD229, 0x00D0,
	2, 0xD22A, 0x0002,
	2, 0xD22B, 0x00E2,
	2, 0xD22C, 0x0002,
	2, 0xD22D, 0x00EE,
	2, 0xD22E, 0x0003,
	2, 0xD22F, 0x0001,
	2, 0xD230, 0x0003,
	2, 0xD231, 0x0026,
	2, 0xD232, 0x0003,
	2, 0xD233, 0x008E,

	2, 0xD300, 0x0000,
	2, 0xD301, 0x0032,
	2, 0xD302, 0x0000,
	2, 0xD303, 0x0033,
	2, 0xD304, 0x0000,
	2, 0xD305, 0x0041,
	2, 0xD306, 0x0000,
	2, 0xD307, 0x005A,
	2, 0xD308, 0x0000,
	2, 0xD309, 0x0076,
	2, 0xD30A, 0x0000,
	2, 0xD30B, 0x00A7,
	2, 0xD30C, 0x0000,
	2, 0xD30D, 0x00CF,
	2, 0xD30E, 0x0001,
	2, 0xD30F, 0x0009,
	2, 0xD310, 0x0001,
	2, 0xD311, 0x0036,
	2, 0xD312, 0x0001,
	2, 0xD313, 0x0073,
	2, 0xD314, 0x0001,
	2, 0xD315, 0x009F,
	2, 0xD316, 0x0001,
	2, 0xD317, 0x00DF,
	2, 0xD318, 0x0002,
	2, 0xD319, 0x0010,
	2, 0xD31A, 0x0002,
	2, 0xD31B, 0x0011,
	2, 0xD31C, 0x0002,
	2, 0xD31D, 0x003D,
	2, 0xD31E, 0x0002,
	2, 0xD31F, 0x0069,
	2, 0xD320, 0x0002,
	2, 0xD321, 0x0081,
	2, 0xD322, 0x0002,
	2, 0xD323, 0x009D,
	2, 0xD324, 0x0002,
	2, 0xD325, 0x00AD,
	2, 0xD326, 0x0002,
	2, 0xD327, 0x00C3,
	2, 0xD328, 0x0002,
	2, 0xD329, 0x00D0,
	2, 0xD32A, 0x0002,
	2, 0xD32B, 0x00E2,
	2, 0xD32C, 0x0002,
	2, 0xD32D, 0x00EE,
	2, 0xD32E, 0x0003,
	2, 0xD32F, 0x0001,
	2, 0xD330, 0x0003,
	2, 0xD331, 0x0026,
	2, 0xD332, 0x0003,
	2, 0xD333, 0x008E,

	2, 0xD400, 0x0000,
	2, 0xD401, 0x0032,
	2, 0xD402, 0x0000,
	2, 0xD403, 0x0033,
	2, 0xD404, 0x0000,
	2, 0xD405, 0x0041,
	2, 0xD406, 0x0000,
	2, 0xD407, 0x005A,
	2, 0xD408, 0x0000,
	2, 0xD409, 0x0076,
	2, 0xD40A, 0x0000,
	2, 0xD40B, 0x00A7,
	2, 0xD40C, 0x0000,
	2, 0xD40D, 0x00CF,
	2, 0xD40E, 0x0001,
	2, 0xD40F, 0x0009,
	2, 0xD410, 0x0001,
	2, 0xD411, 0x0036,
	2, 0xD412, 0x0001,
	2, 0xD413, 0x0073,
	2, 0xD414, 0x0001,
	2, 0xD415, 0x009F,
	2, 0xD416, 0x0001,
	2, 0xD417, 0x00DF,
	2, 0xD418, 0x0002,
	2, 0xD419, 0x0010,
	2, 0xD41A, 0x0002,
	2, 0xD41B, 0x0011,
	2, 0xD41C, 0x0002,
	2, 0xD41D, 0x003D,
	2, 0xD41E, 0x0002,
	2, 0xD41F, 0x0069,
	2, 0xD420, 0x0002,
	2, 0xD421, 0x0081,
	2, 0xD422, 0x0002,
	2, 0xD423, 0x009D,
	2, 0xD424, 0x0002,
	2, 0xD425, 0x00AD,
	2, 0xD426, 0x0002,
	2, 0xD427, 0x00C3,
	2, 0xD428, 0x0002,
	2, 0xD429, 0x00D0,
	2, 0xD42A, 0x0002,
	2, 0xD42B, 0x00E2,
	2, 0xD42C, 0x0002,
	2, 0xD42D, 0x00EE,
	2, 0xD42E, 0x0003,
	2, 0xD42F, 0x0001,
	2, 0xD430, 0x0003,
	2, 0xD431, 0x0026,
	2, 0xD432, 0x0003,
	2, 0xD433, 0x008E,

	2, 0xD500, 0x0000,
	2, 0xD501, 0x0032,
	2, 0xD502, 0x0000,
	2, 0xD503, 0x0033,
	2, 0xD504, 0x0000,
	2, 0xD505, 0x0041,
	2, 0xD506, 0x0000,
	2, 0xD507, 0x005A,
	2, 0xD508, 0x0000,
	2, 0xD509, 0x0076,
	2, 0xD50A, 0x0000,
	2, 0xD50B, 0x00A7,
	2, 0xD50C, 0x0000,
	2, 0xD50D, 0x00CF,
	2, 0xD50E, 0x0001,
	2, 0xD50F, 0x0009,
	2, 0xD510, 0x0001,
	2, 0xD511, 0x0036,
	2, 0xD512, 0x0001,
	2, 0xD513, 0x0073,
	2, 0xD514, 0x0001,
	2, 0xD515, 0x009F,
	2, 0xD516, 0x0001,
	2, 0xD517, 0x00DF,
	2, 0xD518, 0x0002,
	2, 0xD519, 0x0010,
	2, 0xD51A, 0x0002,
	2, 0xD51B, 0x0011,
	2, 0xD51C, 0x0002,
	2, 0xD51D, 0x003D,
	2, 0xD51E, 0x0002,
	2, 0xD51F, 0x0069,
	2, 0xD520, 0x0002,
	2, 0xD521, 0x0081,
	2, 0xD522, 0x0002,
	2, 0xD523, 0x009D,
	2, 0xD524, 0x0002,
	2, 0xD525, 0x00AD,
	2, 0xD526, 0x0002,
	2, 0xD527, 0x00C3,
	2, 0xD528, 0x0002,
	2, 0xD529, 0x00D0,
	2, 0xD52A, 0x0002,
	2, 0xD52B, 0x00E2,
	2, 0xD52C, 0x0002,
	2, 0xD52D, 0x00EE,
	2, 0xD52E, 0x0003,
	2, 0xD52F, 0x0001,
	2, 0xD530, 0x0003,
	2, 0xD531, 0x0026,
	2, 0xD532, 0x0003,
	2, 0xD533, 0x008E,

	2, 0xD600, 0x0000,
	2, 0xD601, 0x0032,
	2, 0xD602, 0x0000,
	2, 0xD603, 0x0033,
	2, 0xD604, 0x0000,
	2, 0xD605, 0x0041,
	2, 0xD606, 0x0000,
	2, 0xD607, 0x005A,
	2, 0xD608, 0x0000,
	2, 0xD609, 0x0076,
	2, 0xD60A, 0x0000,
	2, 0xD60B, 0x00A7,
	2, 0xD60C, 0x0000,
	2, 0xD60D, 0x00CF,
	2, 0xD60E, 0x0001,
	2, 0xD60F, 0x0009,
	2, 0xD610, 0x0001,
	2, 0xD611, 0x0036,
	2, 0xD612, 0x0001,
	2, 0xD613, 0x0073,
	2, 0xD614, 0x0001,
	2, 0xD615, 0x009F,
	2, 0xD616, 0x0001,
	2, 0xD617, 0x00DF,
	2, 0xD618, 0x0002,
	2, 0xD619, 0x0010,
	2, 0xD61A, 0x0002,
	2, 0xD61B, 0x0011,
	2, 0xD61C, 0x0002,
	2, 0xD61D, 0x003D,
	2, 0xD61E, 0x0002,
	2, 0xD61F, 0x0069,
	2, 0xD620, 0x0002,
	2, 0xD621, 0x0081,
	2, 0xD622, 0x0002,
	2, 0xD623, 0x009D,
	2, 0xD624, 0x0002,
	2, 0xD625, 0x00AD,
	2, 0xD626, 0x0002,
	2, 0xD627, 0x00C3,
	2, 0xD628, 0x0002,
	2, 0xD629, 0x00D0,
	2, 0xD62A, 0x0002,
	2, 0xD62B, 0x00E2,
	2, 0xD62C, 0x0002,
	2, 0xD62D, 0x00EE,
	2, 0xD62E, 0x0003,
	2, 0xD62F, 0x0001,
	2, 0xD630, 0x0003,
	2, 0xD631, 0x0026,
	2, 0xD632, 0x0003,
	2, 0xD633, 0x008E,

	/**************LV2 Page 0 enable********/
	2, 0xF000, 0x0055,
	2, 0xF001, 0x00AA,
	2, 0xF002, 0x0052,
	2, 0xF003, 0x0008,
	2, 0xF004, 0x0000,

	/************480x800********************/
	2, 0xB500, 0x0050,

	/************Display control************/
	2, 0xB100, 0x00CC,
	2, 0xB101, 0x0000,

	/************Source hold time***********/
	2, 0xB600, 0x0005,

	/***********Gate EQ control*************/
	2, 0xB700, 0x0070,
	2, 0xB701, 0x0070,

	/***********Source EQ control (Mode 2)**/
	2, 0xB800, 0x0001,
	2, 0xB801, 0x0003,
	2, 0xB802, 0x0003,
	2, 0xB803, 0x0003,

	/**********Inversion mode  (2-dot)******/
	2, 0xBC00, 0x0002,
	2, 0xBC01, 0x0000,
	2, 0xBC02, 0x0000,

	/************Frame rate*****************/
	2, 0xBD00, 0x0001,
	2, 0xBD01, 0x0084,
	2, 0xBD02, 0x001C,
	2, 0xBD03, 0x001C,
	2, 0xBD04, 0x0000,

	/*****Timng control 4H w/ 4-Delayms ****/
	2, 0xC900, 0x00D0,
	2, 0xC901, 0x0002,
	2, 0xC902, 0x0050,
	2, 0xC903, 0x0050,
	2, 0xC904, 0x0050,

	2, 0x3600, 0x0000,
	2, 0x3500, 0x0000,

	2, 0x3A00, 0x0005,

	2, 0X3600, 0X60,
	2, 0X2A02, 0X03,
	2, 0X2A03, 0X1F,
	2, 0X2B02, 0X01,
	2, 0X2B03, 0XDF,

	1, 0x1100,
	DCS_MDELAY_FLAG, 120, /* Delay 120ms */
	1, 0x2900,
	DCS_MDELAY_FLAG, 50, /* Delay 50ms */
	1, 0x2C00,
};

static struct lombo_vo_dev_config wks43178_vo = {
	/* device interface, reference to vo_dev_if_t */
	.dev_if = VO_DEV_CPU_16BIT_RGB565,
	/* device specific configuation, reference to vo_if_cfg_t */
	.cpu_if.has_vsync_cmd = HAS_VSYNC_CMD,
	.cpu_if.has_hsync_cmd = HAS_HSYNC_CMD,
	.cpu_if.cmd_align = CMD_ALIGN,
	.cpu_if.te_pol = TCON_IO_POS,
	.has_te = HAS_TE,
	.te_pol = TCON_IO_POS,

	/* tcon host config */
	/* timing, reference to tcon_timings_t */
	.timing.is_interlace = 0,
	.timing.field1.vt = WKS43178_VSW + WKS43178_VBP
			  + WKS43178_VACT + WKS43178_VFP,
	.timing.field1.vact = WKS43178_VACT,
	.timing.field1.vfp = WKS43178_VFP,
	.timing.field1.vsw = WKS43178_VSW,
	.timing.hline.ht = WKS43178_HSW + WKS43178_HBP
			 + WKS43178_HACT + WKS43178_HFP,
	.timing.hline.hact = WKS43178_HACT,
	.timing.hline.hfp = WKS43178_HFP,
	.timing.hline.hsw = WKS43178_HSW,
	.timing.dclk_freq = WKS43178_DCLK,
	/* resolution in pixel */
	.timing.width = WKS43178_HACT,
	.timing.height = WKS43178_VACT,
	/* format, reference to tcon_output_fmt_t */
	.format = TCON_FMT_RGB565,
	/* gamma correction */
	.gamma_en = false,
	.gamma_tbl = gamma_tbl,
};

static struct drm_display_mode wks43178_mode = {
	/* dclk_freq */
	.clock = WKS43178_DCLK / 1000,
	/* width */
	.hdisplay = WKS43178_HACT,
	/* hsync_start = hdisplay + hfp */
	.hsync_start = WKS43178_HACT + WKS43178_HFP,
	/* hsync_end = hdisplay + hfp + hsw */
	.hsync_end = WKS43178_HACT + WKS43178_HFP + WKS43178_HSW,
	/* htotal = hdisplay + hfp + hsw + hbp */
	.htotal = WKS43178_HACT + WKS43178_HFP + WKS43178_HSW + WKS43178_HBP,
	/* height */
	.vdisplay = WKS43178_VACT,
	/* vsync_start = vdisplay + vfp */
	.vsync_start = WKS43178_VACT + WKS43178_VFP,
	/* vsync_end = vdisplay + vfp + vsw */
	.vsync_end = WKS43178_VACT + WKS43178_VFP + WKS43178_VSW,
	/* vtotal = vdisplay + vfp + vsw + vbp */
	.vtotal = WKS43178_VACT + WKS43178_VFP + WKS43178_VSW + WKS43178_VBP,
	.vrefresh = 60,

	.private_size = sizeof(wks43178_vo),
	.private = (int *)&wks43178_vo,
};

static struct panel_delay wks43178_delay = {
	.prepare = 50,
	.unprepare = 50,
	.enable = 50,
	.disable = 50,
	.power_on = 50,
	.reset = 50,
};

static ssize_t panel_wks43178_wr_init_code(
			struct panel_simple_host *host)
{
	u32 i = 0;
	u32 len = (sizeof(init_code) / sizeof((init_code)[0]));
	u32 *ini_code = &init_code[0];
	u32 bytes = 0;

	if (!ini_code)
		return 0;

	while (i < len) {
		if (ini_code[i] == 0) {
			mdelay(ini_code[i + 1]);
			i += 2;
		} else {
			lombo_vo_write_buffer(host->lombo_vo_dev,
					ini_code + i + 1, ini_code[i]);
			i += ini_code[i] + 1;
			bytes += ini_code[i];
		}
	}

	return bytes;
}

const struct panel_simple_desc wks43178_desc = {
	.modes = &wks43178_mode,
	.num_modes = 1,
	.delay = &wks43178_delay,
	.init_panel = PANEL_SIMPLE_CPU,
	.size = {
		.width = 150,
		.height = 100,
	},
	.ops.transfer = panel_wks43178_wr_init_code,
};
