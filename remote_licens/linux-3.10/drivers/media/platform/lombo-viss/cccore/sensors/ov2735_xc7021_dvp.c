/*
 * Copyright (C) 2016-2018, LomboTech Co.Ltd.
 * Author: lomboswer <lomboswer@lombotech.com>
 *
 * ov2735_xc7021 dvp sensor driver code for LomboTech
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */

#include <linux/init.h>
#include <linux/module.h>

#include <linux/slab.h>
#include <linux/clk.h>
#include <linux/delay.h>
#include <linux/io.h>
#include <linux/viss_isp.h>

#include <media/lombo_viss.h>

#include <mach/debug.h>
#include "../ccc.h"

/* isp xc7021_init */

static const cc_reg_t xc7021_init_reg_list[] = {
	/*  XC7021 setting */
	/* init */
	{ 0xfffd, 0x80 },
	{ 0xfffe, 0x50 },
	{ 0x001c, 0xff },
	{ 0x001d, 0xff },
	{ 0x001e, 0xff },
	{ 0x001f, 0xff },/* clk en */
	{ 0x0018, 0x00 },
	{ 0x0019, 0x00 },
	{ 0x001a, 0x00 },
	{ 0x001b, 0x00 },/* reset */
	{ 0x00bc, 0x11 },/* pad */
	{ 0x00bd, 0x00 },
	{ 0x00be, 0x00 },
	{ 0x00bf, 0x00 },

	/* pll_clk */
	{ 0x0030, 0x09 },
	{ 0x0031, 0x02 },
	{ 0x0032, 0x0c },
	{ 0x0020, 0x02 },
	{ 0x0021, 0x0E },
	{ 0x0023, 0x02 },
	{ 0x0024, 0x06 },
	{ 0x0025, 0x00 },
	{ 0x0026, 0x01 },
	{ 0x0027, 0x06 },

	{ 0xfffd, 0x80 },
	{ 0xfffe, 0x50 },
	{ 0x00bc, 0x11 },
	{ 0x001b, 0x00 },
	{ 0x0090, 0x29 },/* colobar */

	{ 0xfffe, 0x20 },/* cif sensor input size */
	{ 0x0000, 0x00 },
	{ 0x0004, 0x07 },
	{ 0x0005, 0x80 },
	{ 0x0006, 0x04 },
	{ 0x0007, 0x38 },

	{ 0xfffe, 0x26 },/* fifo */
	{ 0x4000, 0xF9 },/* ISP output format */
	{ 0x6001, 0x14 },
	{ 0x6005, 0xc4 },
	{ 0x6006, 0x0F },
	{ 0x6007, 0xA0 },
	{ 0x6008, 0x0E },
	{ 0x6009, 0xFC },

	/* colobar frame rate */
	{ 0x8000, 0x0f },/* 1f-15fps (pixel_rate) */
	{ 0x8001, 0x80 },
	{ 0x8002, 0x07 },/* colobar size(hsize) */
	{ 0x8003, 0x38 },
	{ 0x8004, 0x04 },/* (vsize) */
	{ 0x8005, 0x03 },/* (vdelay) */
	{ 0x8006, 0x05 },
	{ 0x8007, 0x42 },/* (vblank) */
	{ 0x8008, 0x15 },/* (hblank) */

	{ 0x8010, 0x04 },/* crop enable */
	{ 0x8012, 0x80 },/* crop before isp size */
	{ 0x8013, 0x07 },
	{ 0x8014, 0x38 },
	{ 0x8015, 0x04 },
	{ 0x8016, 0x00 },
	{ 0x8017, 0x00 },
	{ 0x8018, 0x00 },
	{ 0x8019, 0x00 },

	{ 0xfffe, 0x30 },
	{ 0x0001, 0x01 },/* yee&crop */
	{ 0x0004, 0x18 },

	{ 0x0006, 0x07 },/* isp in size */
	{ 0x0007, 0x80 },
	{ 0x0008, 0x04 },
	{ 0x0009, 0x38 },
	{ 0x000a, 0x07 },/* isp out size */
	{ 0x000b, 0x80 },
	{ 0x000c, 0x04 },
	{ 0x000d, 0x38 },

	{ 0x0027, 0xF1 },
	{ 0x005e, 0x07 },/* isp in start addr */
	{ 0x005f, 0x7F },
	{ 0x0060, 0x04 },
	{ 0x0061, 0x37 },

	{ 0x1908, 0x00 },/* win_man_en[0] */
	{ 0x1900, 0x00 },/* crop start addr */
	{ 0x1901, 0x00 },
	{ 0x1902, 0x00 },
	{ 0x1903, 0x00 },
	{ 0x1904, 0x07 },/* (isp win) */
	{ 0x1905, 0x80 },
	{ 0x1906, 0x04 },
	{ 0x1907, 0x38 },

	{ 0xfffe, 0x25 },
	/* 0x200b, 0x33 de-glitch */
	{ 0x0002, 0x80 },/* I2C master speed */

	{ 0xfffe, 0x50 },
	{ 0x00aa, 0x70 },
	{ 0x0200, 0x03 },
	{ 0x0204, 0x03 },
	{ 0x0208, 0x01 },

	/* AE */
	{ 0xfffe, 0x14 },
	{ 0x0026, 0x01 },
	{ 0x00be, 0x78 },/* camera i2c id */
	{ 0x00bf, 0x00 },/* camera i2c bits */
	{ 0x00c0, 0x05 },/* sensor type gain */
	{ 0x00c1, 0x02 },/* sensor type exposure */
	{ 0x00c3, 0x00 },/* sensor mode select */

	/* exposure */
	{ 0x00c4, 0x00 },/* write camera exposure variable */
	{ 0x00c5, 0x03 },
	{ 0x00c6, 0x00 },/* write camera exposure variable */
	{ 0x00c7, 0x04 },

	{ 0x00cc, 0x00 },/* camera exposure addr mask 1 */
	{ 0x00cd, 0xff },
	{ 0x00ce, 0x00 },/* camera exposure addr mask 2 */
	{ 0x00cf, 0xff },

	/* gain */
	{ 0x00e4, 0x00 },/* camera gain addr */
	{ 0x00e5, 0x24 },
	{ 0x00ec, 0x00 },/* camera gain addr mask 1 */
	{ 0x00ed, 0xff },

	{ 0xfffe, 0x30 },/* AVG */

	{ 0x1f00, 0x00 },
	{ 0x1f01, 0x00 },
	{ 0x1f02, 0x00 },
	{ 0x1f03, 0x00 },
	{ 0x1f04, 0x07 },
	{ 0x1f05, 0x80 },
	{ 0x1f06, 0x04 },
	{ 0x1f07, 0x38 },

	{ 0x1f08, 0x03 },

	/* AE window */
	{ 0xfffe, 0x14 },

	{ 0x003f, 0x10 },
	{ 0x0040, 0x10 },
	{ 0x0041, 0x10 },
	{ 0x0042, 0x10 },
	{ 0x0043, 0x10 },
	{ 0x0044, 0x10 },
	{ 0x0045, 0x10 },
	{ 0x0046, 0x10 },
	{ 0x0047, 0x10 },
	{ 0x0048, 0x10 },
	{ 0x0049, 0x10 },
	{ 0x004a, 0x10 },
	{ 0x004b, 0x10 },
	{ 0x004c, 0x10 },
	{ 0x004d, 0x10 },
	{ 0x004e, 0x10 },
	{ 0x004f, 0x10 },
	{ 0x0050, 0x10 },
	{ 0x0051, 0x10 },
	{ 0x0052, 0x10 },
	{ 0x0053, 0x10 },
	{ 0x0054, 0x10 },
	{ 0x0055, 0x10 },
	{ 0x0056, 0x10 },
	{ 0x0057, 0x10 },
	{ 0x0058, 0x10 },
	{ 0x0059, 0x10 },
	{ 0x005a, 0x10 },
	{ 0x005b, 0x10 },
	{ 0x005c, 0x10 },
	{ 0x005d, 0x10 },

	{ 0x003a, 0x01 },/* bCfgRefresh */

	/* banding */
	{ 0x00b4, 0x00 },/* banding mode */
	{ 0x00b8, 0x0b },/* banding  exposure lines */
	{ 0x00b9, 0xb0 },

	{ 0x0035, 0x01 },/* bAEAGForceWrite; */

	/* AE CFG */
	{ 0xfffe, 0x14 },
	{ 0x00aa, 0x01 },
	{ 0x00ab, 0x40 },/* max gain */
	{ 0x00ba, 0x00 },/* low light mode */
	{ 0x006a, 0x01 },
	{ 0x006b, 0x40 },/* night target */
	{ 0x006c, 0x01 },
	{ 0x006d, 0xf0 },/* day target */
	{ 0x0073, 0x08 },/* AttAvgReviseDiff */

	/* AE SPEED */
	{ 0xfffe, 0x14 },
	{ 0x0039, 0x01 },/* DETECT enable */
	{ 0x0060, 0x00 },/* smart mode 03 */

	/* 0x0071, 0x60 target offset */
	{ 0x0076, 0x01 },/* delay frame */
	{ 0x0079, 0x01 },
	{ 0x007a, 0x00 },
	{ 0x007b, 0x28 },/* 1. threshold low */
	{ 0x007c, 0x00 },
	{ 0x007d, 0x50 },/* 2. threshold high */
	{ 0x0077, 0x10 },/* 3. finally thr */
	{ 0x0078, 0x01 },/* total speed */
	{ 0x007f, 0x80 },/* jump threshold */
	{ 0x0087, 0x60 },/* jump ratio */
	{ 0x0088, 0x02 },/* jump times */
	{ 0x008c, 0x02 },
	{ 0x008d, 0xc0 },

	/* AE SMART */

	{ 0x0110, 0x01 },
	{ 0x0112, 0x03 },/* Att Detect Speed */
	{ 0x0113, 0x03 },
	{ 0x0114, 0x03 },/* below or above cnt */
	{ 0x011a, 0x00 },
	{ 0x011b, 0x60 },/* day min attention  avg thr */
	{ 0x011c, 0x02 },
	{ 0x011d, 0x80 },/* day max attention  avg thr */
	{ 0x011e, 0x00 },
	{ 0x011f, 0x40 },/* day min avg thr */
	{ 0x0120, 0x02 },
	{ 0x0121, 0xc0 },/* day max avg thr */
	{ 0x0062, 0x00 },
	{ 0x0063, 0x60 },/*  D-N */
	{ 0x0064, 0x00 },
	{ 0x0065, 0x40 },/*  N-D */
	{ 0x0066, 0x01 },
	{ 0x0067, 0x00 },/* dark thr */
	{ 0x0074, 0x20 },/* diff ratio low */
	{ 0x0075, 0x40 },/* diff ratio high */
	{ 0x006e, 0x06 },/* magnituede offset */
	{ 0x006f, 0x01 },/* magnituede MIN */
	{ 0x012a, 0x05 },/* variance thr promote luma */
	{ 0x012b, 0x00 },
	{ 0x012c, 0x00 },/* variance ratio */
	{ 0x012d, 0x30 },

	/* patch start */

	{ 0xfffd, 0x80 },
	{ 0xfffe, 0x50 },
	{ 0x000e, 0x54 },

	{ 0xfffe, 0x14 },
	{ 0x0006, 0x00 },
	{ 0x0007, 0x1e },
	{ 0x0014, 0x00 },
	{ 0x0015, 0x14 },
	{ 0x0016, 0x05 },
	{ 0x0017, 0x0c },
	{ 0x03d4, 0x9c },
	{ 0x03d5, 0x21 },
	{ 0x03d6, 0xff },
	{ 0x03d7, 0xf4 },
	{ 0x03d8, 0xd4 },
	{ 0x03d9, 0x01 },
	{ 0x03da, 0x48 },
	{ 0x03dc, 0xd4 },
	{ 0x03dd, 0x01 },
	{ 0x03de, 0x50 },
	{ 0x03df, 0x04 },
	{ 0x03e0, 0xd4 },
	{ 0x03e1, 0x01 },
	{ 0x03e2, 0x60 },
	{ 0x03e3, 0x08 },
	{ 0x03e4, 0x19 },
	{ 0x03e5, 0x80 },
	{ 0x03e7, 0x14 },
	{ 0x03e8, 0xa9 },
	{ 0x03e9, 0x8c },
	{ 0x03ea, 0x02 },
	{ 0x03eb, 0xb0 },
	{ 0x03ec, 0x9c },
	{ 0x03ed, 0x80 },
	{ 0x03ef, 0x01 },
	{ 0x03f0, 0x84 },
	{ 0x03f1, 0xcc },
	{ 0x03f4, 0x84 },
	{ 0x03f5, 0xa6 },
	{ 0x03f7, 0xd0 },
	{ 0x03f8, 0xe1 },
	{ 0x03f9, 0x45 },
	{ 0x03fa, 0x20 },
	{ 0x03fb, 0x48 },
	{ 0x03fc, 0xbc },
	{ 0x03fd, 0x4a },
	{ 0x03ff, 0x0f },
	{ 0x0400, 0x10 },
	{ 0x0403, 0x03 },
	{ 0x0404, 0x9c },
	{ 0x0405, 0x60 },
	{ 0x0407, 0xfd },
	{ 0x0408, 0x9d },
	{ 0x0409, 0x40 },
	{ 0x040b, 0x10 },
	{ 0x040c, 0x07 },
	{ 0x040d, 0xfb },
	{ 0x040e, 0x1a },
	{ 0x040f, 0x12 },
	{ 0x0410, 0x8c },
	{ 0x0411, 0xa6 },
	{ 0x0413, 0x8b },
	{ 0x0414, 0x84 },
	{ 0x0415, 0x6c },
	{ 0x0418, 0xa8 },
	{ 0x0419, 0x8a },
	{ 0x041c, 0x8c },
	{ 0x041d, 0xa3 },
	{ 0x041f, 0x8b },
	{ 0x0420, 0x07 },
	{ 0x0421, 0xfb },
	{ 0x0422, 0x1a },
	{ 0x0423, 0x0d },
	{ 0x0424, 0x94 },
	{ 0x0425, 0x63 },
	{ 0x0427, 0xb0 },
	{ 0x0428, 0x84 },
	{ 0x0429, 0x8c },
	{ 0x042c, 0x9c },
	{ 0x042d, 0x60 },
	{ 0x042f, 0x01 },
	{ 0x0430, 0x8c },
	{ 0x0431, 0xa4 },
	{ 0x0433, 0x8b },
	{ 0x0434, 0x07 },
	{ 0x0435, 0xfb },
	{ 0x0436, 0x1a },
	{ 0x0437, 0x08 },
	{ 0x0438, 0xa8 },
	{ 0x0439, 0x83 },
	{ 0x043c, 0x85 },
	{ 0x043d, 0x21 },
	{ 0x0440, 0x85 },
	{ 0x0441, 0x41 },
	{ 0x0443, 0x04 },
	{ 0x0444, 0x85 },
	{ 0x0445, 0x81 },
	{ 0x0447, 0x08 },
	{ 0x0448, 0x44 },
	{ 0x044a, 0x48 },
	{ 0x044c, 0x9c },
	{ 0x044d, 0x21 },
	{ 0x044f, 0x0c },
	{ 0x0450, 0x9c },
	{ 0x0451, 0x21 },
	{ 0x0452, 0xff },
	{ 0x0453, 0xf4 },
	{ 0x0454, 0xd4 },
	{ 0x0455, 0x01 },
	{ 0x0456, 0x48 },
	{ 0x0458, 0xd4 },
	{ 0x0459, 0x01 },
	{ 0x045a, 0x50 },
	{ 0x045b, 0x04 },
	{ 0x045c, 0xd4 },
	{ 0x045d, 0x01 },
	{ 0x045e, 0x60 },
	{ 0x045f, 0x08 },
	{ 0x0460, 0x19 },
	{ 0x0461, 0x80 },
	{ 0x0463, 0x14 },
	{ 0x0464, 0xa9 },
	{ 0x0465, 0x8c },
	{ 0x0466, 0x02 },
	{ 0x0467, 0xb0 },
	{ 0x0468, 0x84 },
	{ 0x0469, 0x6c },
	{ 0x046c, 0x84 },
	{ 0x046d, 0xc3 },
	{ 0x046f, 0xcc },
	{ 0x0470, 0x8c },
	{ 0x0471, 0xa3 },
	{ 0x0473, 0x8b },
	{ 0x0474, 0xb8 },
	{ 0x0475, 0x86 },
	{ 0x0477, 0x4c },
	{ 0x0478, 0xb9 },
	{ 0x0479, 0x46 },
	{ 0x047b, 0x44 },
	{ 0x047c, 0x94 },
	{ 0x047d, 0x63 },
	{ 0x047f, 0x90 },
	{ 0x0480, 0x07 },
	{ 0x0481, 0xfb },
	{ 0x0482, 0x19 },
	{ 0x0483, 0xf5 },
	{ 0x0484, 0xa4 },
	{ 0x0485, 0x84 },
	{ 0x0487, 0xff },
	{ 0x0488, 0x84 },
	{ 0x0489, 0x6c },
	{ 0x048c, 0xa4 },
	{ 0x048d, 0x8a },
	{ 0x048f, 0xff },
	{ 0x0490, 0x8c },
	{ 0x0491, 0xa3 },
	{ 0x0493, 0x8b },
	{ 0x0494, 0x07 },
	{ 0x0495, 0xfb },
	{ 0x0496, 0x19 },
	{ 0x0497, 0xf0 },
	{ 0x0498, 0x94 },
	{ 0x0499, 0x63 },
	{ 0x049b, 0x92 },
	{ 0x049c, 0x84 },
	{ 0x049d, 0x8c },
	{ 0x04a0, 0x9c },
	{ 0x04a1, 0x60 },
	{ 0x04a3, 0x01 },
	{ 0x04a4, 0x8c },
	{ 0x04a5, 0xa4 },
	{ 0x04a7, 0x8b },
	{ 0x04a8, 0x07 },
	{ 0x04a9, 0xfb },
	{ 0x04aa, 0x19 },
	{ 0x04ab, 0xeb },
	{ 0x04ac, 0xa8 },
	{ 0x04ad, 0x83 },
	{ 0x04b0, 0x85 },
	{ 0x04b1, 0x21 },
	{ 0x04b4, 0x85 },
	{ 0x04b5, 0x41 },
	{ 0x04b7, 0x04 },
	{ 0x04b8, 0x85 },
	{ 0x04b9, 0x81 },
	{ 0x04bb, 0x08 },
	{ 0x04bc, 0x44 },
	{ 0x04be, 0x48 },
	{ 0x04c0, 0x9c },
	{ 0x04c1, 0x21 },
	{ 0x04c3, 0x0c },
	{ 0x04c4, 0x9c },
	{ 0x04c5, 0x21 },
	{ 0x04c6, 0xff },
	{ 0x04c7, 0xfc },
	{ 0x04c8, 0xd4 },
	{ 0x04c9, 0x01 },
	{ 0x04ca, 0x48 },
	{ 0x04cc, 0xbc },
	{ 0x04cd, 0x03 },
	{ 0x04ce, 0x04 },
	{ 0x04cf, 0x0b },
	{ 0x04d0, 0x10 },
	{ 0x04d3, 0x06 },
	{ 0x04d4, 0xbc },
	{ 0x04d5, 0x03 },
	{ 0x04d6, 0x04 },
	{ 0x04d7, 0x0c },
	{ 0x04d8, 0x0c },
	{ 0x04db, 0x0a },
	{ 0x04dc, 0x15 },
	{ 0x04e3, 0x06 },
	{ 0x04e4, 0x15 },
	{ 0x04e8, 0x07 },
	{ 0x04e9, 0xff },
	{ 0x04ea, 0xff },
	{ 0x04eb, 0xda },
	{ 0x04ec, 0x15 },
	{ 0x04f3, 0x04 },
	{ 0x04f4, 0x15 },
	{ 0x04f8, 0x07 },
	{ 0x04f9, 0xff },
	{ 0x04fa, 0xff },
	{ 0x04fb, 0xb7 },
	{ 0x04fc, 0x15 },
	{ 0x0500, 0x85 },
	{ 0x0501, 0x21 },
	{ 0x0504, 0x44 },
	{ 0x0506, 0x48 },
	{ 0x0508, 0x9c },
	{ 0x0509, 0x21 },
	{ 0x050b, 0x04 },
	{ 0x050c, 0x9c },
	{ 0x050d, 0x21 },
	{ 0x050e, 0xff },
	{ 0x050f, 0xfc },
	{ 0x0510, 0xd4 },
	{ 0x0511, 0x01 },
	{ 0x0512, 0x48 },
	{ 0x0514, 0x07 },
	{ 0x0515, 0xff },
	{ 0x0516, 0xff },
	{ 0x0517, 0xec },
	{ 0x0518, 0x15 },
	{ 0x051c, 0x18 },
	{ 0x051d, 0x60 },
	{ 0x051f, 0x14 },
	{ 0x0520, 0xa8 },
	{ 0x0521, 0x63 },
	{ 0x0522, 0x03 },
	{ 0x0523, 0x18 },
	{ 0x0524, 0x9d },
	{ 0x0525, 0x60 },
	{ 0x0528, 0x84 },
	{ 0x0529, 0x63 },
	{ 0x052c, 0xd4 },
	{ 0x052d, 0x03 },
	{ 0x052e, 0x59 },
	{ 0x052f, 0xcc },
	{ 0x0530, 0xd4 },
	{ 0x0531, 0x03 },
	{ 0x0532, 0x59 },
	{ 0x0533, 0xc0 },
	{ 0x0534, 0xd4 },
	{ 0x0535, 0x03 },
	{ 0x0536, 0x59 },
	{ 0x0537, 0xc4 },
	{ 0x0538, 0xd4 },
	{ 0x0539, 0x03 },
	{ 0x053a, 0x59 },
	{ 0x053b, 0xc8 },
	{ 0x053c, 0x85 },
	{ 0x053d, 0x21 },
	{ 0x0540, 0x44 },
	{ 0x0542, 0x48 },
	{ 0x0544, 0x9c },
	{ 0x0545, 0x21 },
	{ 0x0547, 0x04 },

	/* patch configure */
	{ 0x00c0, 0x05 },/* sensor type gain */

	{ 0x006e, 0x30 },/* magnitude offset */
	{ 0x006f, 0x20 },/* magnitude Min */
	{ 0x0070, 0xc0 },/* magnitude MAX */

	{ 0x0131, 0x02 },/* GAIN offset =2 */
	/* ENABLE */
	{ 0xfffe, 0x30 },
	{ 0x0051, 0x03 },

	{ 0xfffe, 0x50 },
	{ 0x0137, 0x99 },

	{ 0xfffe, 0x14 },
	/* patch end */

	/* AE SENSOR  END */
	{ 0xfffe, 0x30 },/* lenc_95-0517 */
	{ 0x0200, 0x13 },
	{ 0x0201, 0x0d },
	{ 0x0202, 0x09 },
	{ 0x0203, 0x0a },
	{ 0x0204, 0x0c },
	{ 0x0205, 0x16 },
	{ 0x0206, 0x06 },
	{ 0x0207, 0x03 },
	{ 0x0208, 0x03 },
	{ 0x0209, 0x02 },
	{ 0x020a, 0x03 },
	{ 0x020b, 0x06 },
	{ 0x020c, 0x03 },
	{ 0x020d, 0x01 },
	{ 0x020e, 0x00 },
	{ 0x020f, 0x00 },
	{ 0x0210, 0x01 },
	{ 0x0211, 0x03 },
	{ 0x0212, 0x03 },
	{ 0x0213, 0x01 },
	{ 0x0214, 0x00 },
	{ 0x0215, 0x00 },
	{ 0x0216, 0x01 },
	{ 0x0217, 0x02 },
	{ 0x0218, 0x06 },
	{ 0x0219, 0x04 },
	{ 0x021a, 0x02 },
	{ 0x021b, 0x02 },
	{ 0x021c, 0x03 },
	{ 0x021d, 0x05 },
	{ 0x021e, 0x13 },
	{ 0x021f, 0x0d },
	{ 0x0220, 0x0a },
	{ 0x0221, 0x0b },
	{ 0x0222, 0x0e },
	{ 0x0223, 0x15 },
	{ 0x0224, 0x10 },
	{ 0x0225, 0x21 },
	{ 0x0226, 0x31 },
	{ 0x0227, 0x21 },
	{ 0x0228, 0x11 },
	{ 0x022a, 0x31 },
	{ 0x022b, 0x31 },
	{ 0x022c, 0x31 },
	{ 0x022d, 0x31 },
	{ 0x022e, 0x31 },
	{ 0x0230, 0x31 },
	{ 0x0231, 0x31 },
	{ 0x0232, 0x31 },
	{ 0x0233, 0x31 },
	{ 0x0234, 0x31 },
	{ 0x0236, 0x21 },
	{ 0x0237, 0x21 },
	{ 0x0238, 0x31 },
	{ 0x0239, 0x31 },
	{ 0x023a, 0x21 },
	{ 0x023c, 0x01 },
	{ 0x023d, 0x21 },
	{ 0x023e, 0x21 },
	{ 0x023f, 0x11 },
	{ 0x0240, 0x11 },
	{ 0x0248, 0xdf },

	{ 0xfffe, 0x30 },
	{ 0x024d, 0x00 },
	{ 0x024e, 0xCC },
	{ 0x024f, 0x01 },
	{ 0x0250, 0x6C },
	{ 0x0251, 0x01 },
	{ 0x0252, 0x11 },
	{ 0x0253, 0x00 },
	{ 0x0254, 0xF2 },

	{ 0xfffd, 0x80 },
	{ 0xfffe, 0x30 },
	{ 0x0013, 0x40 },/* bias_man(BLC) */

	{ 0xfffe, 0x14 },/* AWB_init */
	{ 0x0027, 0x01 },
	{ 0x013c, 0x02 },
	{ 0x0176, 0x06 },/* int B gain */
	{ 0x0177, 0x00 },
	{ 0x017a, 0x04 },/* int Gb gain */
	{ 0x017b, 0x00 },
	{ 0x017e, 0x04 },/* int Gr gain */
	{ 0x017f, 0x00 },
	{ 0x0182, 0x04 },/* int R gain */
	{ 0x0183, 0x04 },
	{ 0x01aa, 0x06 },/* B_temp */
	{ 0x01ab, 0x00 },
	{ 0x01ae, 0x04 },/* G_ temp */
	{ 0x01af, 0x00 },
	{ 0x01b2, 0x04 },/* R_temp */
	{ 0x01b3, 0x04 },

	{ 0xfffe, 0x14 },/* C_AWB */
	{ 0x0027, 0x01 },
	{ 0x013c, 0x01 },
	{ 0x013d, 0x01 },
	{ 0x013e, 0x00 },
	{ 0x0170, 0x0d },
	{ 0x0171, 0xff },
	{ 0x016e, 0x08 },

	{ 0xfffe, 0x30 },

	{ 0x0708, 0x02 },/* pixel max value[9:8] 03 */
	{ 0x0709, 0x00 },/* pixel max value[7:0] f0 */
	{ 0x070a, 0x00 },/* pixel min value[9:8] */
	{ 0x070b, 0x10 },/* pixel min value[7:0] */
	{ 0x071c, 0x0a },/* simple awb */
	{ 0x0003, 0x31 },

	{ 0xfffd, 0x80 },
	{ 0xfffe, 0x30 },

	{ 0x0730, 0x84 },/* win1 startx */
	{ 0x0731, 0xa8 },/* win1 endx */
	{ 0x0732, 0x41 },/* win1 starty */
	{ 0x0733, 0x5a },/* win1 endy */
	{ 0x0734, 0x75 },/* win2 startx */
	{ 0x0735, 0xa8 },/* win2 endx */
	{ 0x0736, 0x60 },/* win2 starty */
	{ 0x0737, 0x80 },/* win2 endy */
	{ 0x0738, 0x4c },/* win3 startx */
	{ 0x0739, 0x72 },/* win3 endx */
	{ 0x073a, 0x64 },/* win3 starty */
	{ 0x073b, 0xa0 },/* win3 endy */
	{ 0x073c, 0x70 },/* win4 startx */
	{ 0x073d, 0x9b },/* win4 endx */
	{ 0x073e, 0x52 },/* win4 starty */
	{ 0x073f, 0x70 },/* win4 endy */
	{ 0x0740, 0x60 },/* win5 startx */
	{ 0x0741, 0x90 },/* win5 endx */
	{ 0x0742, 0x70 },/* win5 starty */
	{ 0x0743, 0x9a },/* win5 endy */
	{ 0x0744, 0x00 },/* win6 startx */
	{ 0x0745, 0x00 },/* win6 endx */
	{ 0x0746, 0x00 },/* win6 starty */
	{ 0x0747, 0x00 },/* win6 endy */
	{ 0x0748, 0x00 },/* win7 startx */
	{ 0x0749, 0x00 },/* win7 endx */
	{ 0x074a, 0x00 },/* win7 starty */
	{ 0x074b, 0x00 },/* win7 endy */
	{ 0x074c, 0x00 },/* win8 startx */
	{ 0x074d, 0x00 },/* win8 endx  */
	{ 0x074e, 0x00 },/* win8 starty */
	{ 0x074f, 0x00 },/* win8 endy */
	{ 0x0750, 0x00 },/* win9 startx */
	{ 0x0751, 0x00 },/* win9 endx */
	{ 0x0752, 0x00 },/* win9 starty */
	{ 0x0753, 0x00 },/* win9 endy */
	{ 0x0754, 0x00 },/* win10 startx */
	{ 0x0755, 0x00 },/* win10 endx */
	{ 0x0756, 0x00 },/* win10 starty */
	{ 0x0757, 0x00 },/* win10 endy */
	{ 0x0758, 0x00 },/* win11 startx */
	{ 0x0759, 0x00 },/* win11 endx */
	{ 0x075a, 0x00 },/* win11 starty */
	{ 0x075b, 0x00 },/* win11 endy */
	{ 0x075c, 0x00 },/* win12 startx */
	{ 0x075d, 0x00 },/* win12 endx */
	{ 0x075e, 0x00 },/* win12 starty */
	{ 0x075f, 0x00 },/* win12 endy */
	{ 0x0760, 0x00 },/* win13 startx */
	{ 0x0761, 0x00 },/* win13 endx */
	{ 0x0762, 0x00 },/* win13 starty */
	{ 0x0763, 0x00 },/* win13 endy */
	{ 0x0764, 0x00 },/* win14 startx */
	{ 0x0765, 0x00 },/* win14 endx */
	{ 0x0766, 0x00 },/* win14 starty */
	{ 0x0767, 0x00 },/* win14 endy */
	{ 0x0768, 0x00 },/* win15 startx */
	{ 0x0769, 0x00 },/* win15 endx */
	{ 0x076a, 0x00 },/* win15 starty */
	{ 0x076b, 0x00 },/* win15 endy */
	{ 0x076c, 0x00 },/* win16 startx */
	{ 0x076d, 0x00 },/* win16 endx */
	{ 0x076e, 0x00 },/* win16 starty */
	{ 0x076f, 0x00 },/* win16 endy */
	{ 0x0770, 0x22 },/* wt1 wt2 */
	{ 0x0771, 0x22 },/* wt3 wt4 */
	{ 0x0772, 0x10 },/* wt5 wt6 */
	{ 0x0773, 0x00 },/* wt7 wt8 */
	{ 0x0774, 0x00 },/* wt9 wt10 */
	{ 0x0775, 0x00 },/* wt11 wt12 */
	{ 0x0776, 0x00 },/* wt13 wt14 */
	{ 0x0777, 0x00 },/* wt15 wt16 */

	{ 0xfffd, 0x80 },/* gamma */
	{ 0xfffe, 0x30 },/* 20180903-2 */

	{ 0x1400, 0x00 },
	{ 0x1401, 0x00 },
	{ 0x1402, 0x00 },
	{ 0x1403, 0x00 },
	{ 0x1404, 0x00 },
	{ 0x1405, 0x00 },
	{ 0x1406, 0x00 },
	{ 0x1407, 0x00 },
	{ 0x1408, 0x00 },
	{ 0x1409, 0x09 },
	{ 0x140a, 0x12 },
	{ 0x140b, 0x1a },
	{ 0x140c, 0x23 },
	{ 0x140d, 0x2b },
	{ 0x140e, 0x33 },
	{ 0x140f, 0x3b },
	{ 0x1410, 0x43 },
	{ 0x1411, 0x4b },
	{ 0x1412, 0x52 },
	{ 0x1413, 0x59 },
	{ 0x1414, 0x5f },
	{ 0x1415, 0x65 },
	{ 0x1416, 0x6b },
	{ 0x1417, 0x70 },
	{ 0x1418, 0x75 },
	{ 0x1419, 0x79 },
	{ 0x141a, 0x7d },
	{ 0x141b, 0x81 },
	{ 0x141c, 0x84 },
	{ 0x141d, 0x88 },
	{ 0x141e, 0x8b },
	{ 0x141f, 0x8d },
	{ 0x1420, 0x90 },
	{ 0x1421, 0x95 },
	{ 0x1422, 0x99 },
	{ 0x1423, 0x9c },
	{ 0x1424, 0x9f },
	{ 0x1425, 0xa3 },
	{ 0x1426, 0xa6 },
	{ 0x1427, 0xa9 },
	{ 0x1428, 0xac },
	{ 0x1429, 0xaf },
	{ 0x142a, 0xb2 },
	{ 0x142b, 0xb5 },
	{ 0x142c, 0xb7 },
	{ 0x142d, 0xba },
	{ 0x142e, 0xbd },
	{ 0x142f, 0xbf },
	{ 0x1430, 0xc2 },
	{ 0x1431, 0xc6 },
	{ 0x1432, 0xcb },
	{ 0x1433, 0xcf },
	{ 0x1434, 0xd2 },
	{ 0x1435, 0xd6 },
	{ 0x1436, 0xda },
	{ 0x1437, 0xdd },
	{ 0x1438, 0xe1 },
	{ 0x1439, 0xe5 },
	{ 0x143a, 0xe9 },
	{ 0x143b, 0xec },
	{ 0x143c, 0xf0 },
	{ 0x143d, 0xf4 },
	{ 0x143e, 0xf8 },
	{ 0x143f, 0xfc },
	{ 0x1440, 0xff },
	/* 0x1450, 0xff ff */
	/* 0x1451, 0x03 03 */
	/* 0x1452, 0x40 6e */
	/* 0x1453, 0x20 10 */


	{ 0xfffe, 0x30 },/* cmx */

	{ 0x1200, 0x04 },
	{ 0x1201, 0xEC },
	{ 0x1202, 0x00 },
	{ 0x1203, 0x46 },
	{ 0x1204, 0x00 },
	{ 0x1205, 0xC9 },
	{ 0x1206, 0x01 },
	{ 0x1207, 0x97 },
	{ 0x1208, 0x00 },
	{ 0x1209, 0xFF },
	{ 0x120A, 0x01 },
	{ 0x120B, 0xF8 },
	{ 0x120C, 0x06 },
	{ 0x120D, 0xE1 },
	{ 0x120E, 0x02 },
	{ 0x120F, 0x00 },
	{ 0x1210, 0x01 },
	{ 0x1211, 0x70 },
	{ 0x1212, 0x02 },
	{ 0x1213, 0x62 },
	{ 0x1214, 0x01 },
	{ 0x1215, 0x83 },
	{ 0x1216, 0x01 },
	{ 0x1217, 0x6A },
	{ 0x1218, 0x06 },
	{ 0x1219, 0xA2 },
	{ 0x121A, 0x00 },
	{ 0x121B, 0xDB },
	{ 0x121C, 0x00 },
	{ 0x121D, 0xB2 },
	{ 0x121E, 0x03 },
	{ 0x121F, 0x3D },
	{ 0x1220, 0x00 },
	{ 0x1221, 0xEF },
	{ 0x1222, 0x03 },
	{ 0x1223, 0x5F },
	{ 0x122e, 0x00 },
	{ 0x122F, 0x00 },
	{ 0x1230, 0x08 },
	{ 0x1228, 0x00 },
	{ 0x1229, 0x5D },
	{ 0x122A, 0x00 },
	{ 0x122B, 0x9A },
	{ 0x122C, 0x00 },
	{ 0x122D, 0xF0 },
	{ 0x1231, 0x02 },

	{ 0xfffe, 0x30 },/* YEE */
	{ 0x2000, 0x33 },
	/*
	 * bit[5]Yedge en; bit[3]UV_dns_en; bit[2]pre_dns_en;
	 * bit[1]ydns_man; bit[0]uvdns_man
	 */
	{ 0x2001, 0x10 },/* edge_ratio */
	{ 0x2002, 0x02 },/* Y_dns_level_man */
	{ 0x2003, 0x0f },/* UV_dns_level_man */
	{ 0x2004, 0x01 },/* gain list0 */
	{ 0x2005, 0x01 },
	{ 0x2006, 0x02 },
	{ 0x2007, 0x03 },
	{ 0x2008, 0x04 },
	{ 0x2009, 0x05 },
	{ 0x200a, 0x06 },
	{ 0x200b, 0x1f },/* gain list7 */

	{ 0x1907, 0x3a },/* y_win+2 */
	{ 0x1908, 0x01 },/* win_man_en */

	{ 0xfffe, 0x30 },/* RAW_DNS */
	{ 0x0e00, 0x14 },/* 34  bit[5] Para_man_en  bit[4]G_en */
	{ 0x0e01, 0x00 },
	{ 0x0e02, 0x01 },
	{ 0x0e03, 0x04 },
	{ 0x0e04, 0x08 },
	{ 0x0e05, 0x10 },
	{ 0x0e06, 0x20 },
	{ 0x0e07, 0x20 },
	{ 0x0e08, 0x20 },
	{ 0x0e09, 0x3f },
	{ 0x0e0a, 0x04 },
	{ 0x0e0b, 0x10 },

	{ 0xfffe, 0x30 },/* RGB_DNS */
	{ 0x130e, 0x0c },
	{ 0x130f, 0x08 },

	{ 0xfffe, 0x30 },/* cip */
	{ 0x0f00, 0x3f },
	{ 0x0f01, 0x00 },
	{ 0x0f02, 0x08 },
	{ 0x0f03, 0x0f },
	{ 0x0f04, 0x14 },
	{ 0x0f05, 0x24 },
	{ 0x0f06, 0x34 },
	{ 0x0f07, 0x38 },
	{ 0x0f08, 0x38 },
	{ 0x0f09, 0x38 },
	{ 0x0f0a, 0x04 },
	{ 0x0f0b, 0x1f },
	{ 0x0f0c, 0x00 },
	{ 0x0f0d, 0x20 },
	{ 0x0f0e, 0x01 },
	{ 0x0f0f, 0x20 },

	{ 0xfffe, 0x14 },/* saturation adjust */
	{ 0x0160, 0x00 },/* bAutoSat_en */
	{ 0x0162, 0x40 },/* sat_u[0] */
	{ 0x0163, 0x38 },/* sat_u[1] */
	{ 0x0164, 0x30 },/* sat_u[2] */
	{ 0x0165, 0x2c },/* sat_u[3] */
	{ 0x0166, 0x28 },/* sat_u[4] */
	{ 0x0167, 0x24 },/* sat_u[5] */
	{ 0x0168, 0x40 },/* sat_v[0] */
	{ 0x0169, 0x3c },/* sat_v[1] */
	{ 0x016a, 0x34 },/* sat_v[2] */
	{ 0x016b, 0x30 },/* sat_v[3] */
	{ 0x016c, 0x2c },/* sat_v[4] */
	{ 0x016d, 0x28 },/* sat_v[5] */

	/* TOP */
	{ 0xfffe, 0x30 },
	{ 0xfffe, 0x30 },
	/* 0x006c, 0x02 */
	{ 0x0715, 0x04 },
	{ 0x0000, 0x0f },/* [7]lenc_en },[3]raw_dns_en */
	{ 0x0001, 0x81 },/* [5]rgb_dns_en },[2]Yedge_en },[1]rgb_cmx_en }, */
	{ 0x0003, 0xe4 },
	{ 0x0013, 0x40 },
	{ 0x071b, 0xff },
	{ 0x071c, 0x0a },
	{ 0x1700, 0x89 },
	{ 0x1701, 0x44 },
	{ 0x1702, 0x3a },
	{ 0x1704, 0x22 },
	{ 0xfffe, 0x14 },
	{ 0x0026, 0x01 },/* AE enable */
	{ 0x0027, 0x00 },
	{ 0xfffe, 0x30 },
	{ 0x0729, 0x04 },
	{ 0x072a, 0x00 },
	{ 0x072b, 0x04 },
	{ 0x072c, 0x00 },
	{ 0x072d, 0x04 },
	{ 0x072e, 0x00 },
	{ 0xfffe, 0x14 },
};

static const cc_reg_t ov2735_init_reg_list[] = {
	{ 0xfd, 0x00 },
	{ 0x2f, 0x0c },
	{ 0x34, 0x00 },
	{ 0x30, 0x15 },
	{ 0x33, 0x01 },
	{ 0x35, 0x20 },
	{ 0x1d, 0xa5 },
	{ 0xfd, 0x01 },
	{ 0x0d, 0x00 },
	{ 0x30, 0x00 },
	{ 0x03, 0x01 },
	{ 0x04, 0x8f },
	{ 0x01, 0x01 },
	{ 0x09, 0x00 },
	{ 0x0a, 0x20 },
	{ 0x06, 0x14 },
	{ 0x24, 0x10 },
	{ 0x01, 0x01 },
	{ 0xfb, 0x73 },
	{ 0x01, 0x01 },
	{ 0xfd, 0x01 },
	{ 0x1a, 0x6b },
	{ 0x1c, 0xea },
	{ 0x16, 0x0c },
	{ 0x21, 0x00 },
	{ 0x11, 0xe8 },/* 63 */
	{ 0x19, 0xc3 },
	{ 0x26, 0xda },
	{ 0x29, 0x01 },
	{ 0x33, 0x6f },
	{ 0x3f, 0x02 },
	{ 0x2a, 0xd2 },
	{ 0x2c, 0x40 },
	{ 0xd0, 0x02 },
	{ 0xd1, 0x01 },
	{ 0xd2, 0x20 },
	{ 0xd3, 0x03 },/* 04 */
	{ 0xd4, 0xa4 },/* 2a */
	{ 0x50, 0x00 },
	{ 0x51, 0x2c },
	{ 0x52, 0x29 },
	{ 0x53, 0x00 },
	{ 0x55, 0x44 },
	{ 0x58, 0x29 },
	{ 0x5a, 0x00 },
	{ 0x5b, 0x00 },
	{ 0x5d, 0x00 },
	{ 0x64, 0x2f },
	{ 0x66, 0x62 },
	{ 0x68, 0x5b },
	{ 0x75, 0x46 },
	{ 0x76, 0xf0 },
	{ 0x77, 0x4f },
	{ 0x78, 0xef },
	{ 0x72, 0xcf },
	{ 0x73, 0x36 },
	{ 0x7d, 0x0d },
	{ 0x7e, 0x0d },
	{ 0x8a, 0x77 },
	{ 0x8b, 0x77 },
	{ 0x25, 0xe0 },
	{ 0x20, 0x7b },
	{ 0xfd, 0x01 },
	{ 0xfd, 0x02 },
	{ 0x5e, 0x03 },
	{ 0xfd, 0x01 },
	{ 0x86, 0x77 },
	{ 0x89, 0x77 },
	{ 0x87, 0x74 },
	{ 0x88, 0x74 },
	{ 0xfc, 0xe0 },
	{ 0xfe, 0xe0 },
	{ 0xf0, 0x40 },
	{ 0xf1, 0x40 },
	{ 0xf2, 0x40 },
	{ 0xf3, 0x40 },

	/* crop to 1920x1080 */
	{ 0xfd, 0x02 },
	{ 0x36, 0x08 },/* invert Vsync polarity for Gaia */
	{ 0xa0, 0x00 },/* Image vertical start MSB3bits */
	{ 0xa1, 0x08 },/* Image vertical start LSB8bits */
	{ 0xa2, 0x04 },/* image vertical size  MSB8bits */
	{ 0xa3, 0x38 },/* image vertical size  LSB8bits */
	{ 0xa4, 0x00 },
	{ 0xa5, 0x04 },/* H start 8Lsb */
	{ 0xa6, 0x03 },
	{ 0xa7, 0xc0 },/* Half H size Lsb8bits */

	{ 0xfd, 0x03 },
	{ 0xc0, 0x01 },/* enable transfer OTP BP information */
	{ 0xfd, 0x04 },
	{ 0x21, 0x14 },
	{ 0x22, 0x14 },
	{ 0x23, 0x14 },/* enhance normal and dummy BPC */

	{ 0xfd, 0x00 },
	{ 0x1b, 0x00 },/* enable output */
	{ 0xfd, 0x01 },
};

static struct cc_power_act power_up_act[] = {
	{CC_PWDN, CC_UP},
	{CC_DELAY, 5},
	{CC_RESET,  CC_UP},
};

static struct cc_power_act power_down_act[] = {
	{CC_PWDN, CC_DOWN},
	{CC_DELAY, 5},
	{CC_RESET,  CC_DOWN},
};

static const struct cc_frame_format frame_formats[] = {
	{
		.mbus_code = V4L2_MBUS_FMT_YUYV8_2X8,
		.colorspace = V4L2_COLORSPACE_JPEG,
		.field = V4L2_FIELD_NONE,
	},
};

#define FHD_WIDTH		1920
#define FHD_HEIGHT		1080

static const struct cc_win_size win_sizes[] = {
	{
		.width = FHD_WIDTH,
		.height = FHD_HEIGHT,
	},
};

static const struct cc_frame_cfg frame_cfgs[] = {
	{
		.width = FHD_WIDTH,
		.height = FHD_HEIGHT,

		.framerate = { 1, 30 },	/* 30fps */
	},
};

static int xc7021_bypass_stream(struct cc_sensor_info *cc_si, int on)
{
	int ret = -1;
	ret = cc_si->write_reg(cc_si, 0xfffd, 0x80);
	if (ret != 0) {
		PRT_ERR("xc7021_bypass_stream %d\n", on);
		return -ENODEV;
	}

	ret = cc_si->write_reg(cc_si, 0xfffe, 0x50);
	if (ret != 0) {
		PRT_ERR("xc7021_bypass_stream %d\n", on);
		return -ENODEV;
	}

	if (on) {
		ret = cc_si->write_reg(cc_si, 0x004d, 0x01);
		if (ret != 0) {
			PRT_ERR("xc7021_bypass_stream %d\n", on);
			return -ENODEV;
		}
		PRT_INFO("bypass --%d\n", on);

	} else {
		ret = cc_si->write_reg(cc_si, 0x004d, 0x00);
		if (ret != 0) {
			PRT_ERR("xc7021_bypass_stream %d\n", on);
			return -ENODEV;
		}
		PRT_INFO("bypass --%d\n", on);
	}

	return ret;
}

static int sensor_detect(struct cc_sensor_info *cc_si)
{
	int ret = 0;

	return ret;
}

static int sensor_init(struct cc_sensor_info *cc_si)
{
	struct timespec ts_s;
	struct timespec ts_f;
	int ret = 0;

	PRT_INFO("\n");

	ret = sensor_detect(cc_si);
	if (ret != 0)
		return ret;

	ktime_get_ts(&ts_s);
#if 0
	ret = cc_si->write_reg_list(cc_si, init_reg_list,
					ARRAY_SIZE(init_reg_list));
	if (ret != 0) {
		PRT_ERR("write %s init_reg_list failed!\n", cc_si->name);
		return -ENODEV;
	}
#endif
	ktime_get_ts(&ts_f);

#if 0
	{
	u8 value = 0;
	int i;

	for (i = 0; i < ARRAY_SIZE(init_reg_list); i++) {
		if (init_reg_list[i].reg == CC_REG_DELAY)
			continue;

		ret = cc_si->read_reg(cc_si, init_reg_list[i].reg, &value);
		if (ret) {
			PRT_ERR("%s read i %d reg 0x%02x error\n",
				cc_si->name, i, init_reg_list[i].reg);
			return ret;
		}

		if (init_reg_list[i].val != value) {
			PRT_ERR("%s %d 0x%02x (0x%02x) != (0x%02x)\n",
				cc_si->name, i, init_reg_list[i].reg,
				value, init_reg_list[i].val);
		}
	}
	}
#endif

	return 0;
}

static int sensor_set_stream(struct cc_sensor_info *cc_si, int on)
{
	u8 tmp[2];
	int ret = 0;
	u16 id;
	struct timespec ts_s;
	struct timespec ts_f;

	PRT_INFO("sensor_set_stream-------------%d\n", on);

	if (!on)
		return ret;

	ret = cc_si->read_reg(cc_si, 0xfffb, &tmp[0]);
	if (ret != 0) {
		PRT_ERR("XC7021 id: 0x%02x\n", tmp[0]);
		return -ENODEV;
	}
	PRT_INFO("XC7021 id: 0x%02x\n", tmp[0]);

	if (tmp[0] != 0x70) {
		PRT_ERR("ID wrong! (0x%02x != 0x70 )\n", tmp[0]);
		return -ENODEV;
	}

	ktime_get_ts(&ts_s);
#if 1
	ret = cc_si->write_reg_list(cc_si, xc7021_init_reg_list,
					ARRAY_SIZE(xc7021_init_reg_list));
	if (ret != 0) {
		PRT_ERR("write %s xc7021_init_reg_list failed!\n", cc_si->name);
		return -ENODEV;
	}
#endif
	ktime_get_ts(&ts_f);

	PRT_INFO("write %s xc7021_init_reg_list finish.\n", cc_si->name);
	PRT_INFO("timeused %d %d\n", (int)(ts_f.tv_sec - ts_s.tv_sec),
		(int)(ts_f.tv_nsec - ts_s.tv_nsec));

	xc7021_bypass_stream(cc_si, 1);
	cc_si->reg_bits = 8;
	cc_switch_i2c_dev(cc_si, 1);
	sensor_msleep(5);

	ret = cc_si->read_reg(cc_si, 0x02, &tmp[0]);
	if (ret != 0) {
		PRT_ERR("tmp[0]=%x\n", tmp[0]);
		return -ENODEV;
	}
	ret = cc_si->read_reg(cc_si, 0x03, &tmp[1]);
	if (ret != 0) {
		PRT_ERR("tmp[0]=%x,tmp[1]=%x\n", tmp[0], tmp[1]);
		return -ENODEV;
	}
	id = (tmp[0] << 8) | tmp[1];
	PRT_INFO("id: 0x%04x.\n", id);

	if (id != 0x2735) {
		PRT_ERR("ID wrong! (0x%04x != 0x2735)\n", id);
		return -ENODEV;
	}

	ktime_get_ts(&ts_s);
#if 1
	ret = cc_si->write_reg_list(cc_si, ov2735_init_reg_list,
					ARRAY_SIZE(ov2735_init_reg_list));
	if (ret != 0) {
		PRT_ERR("write %s ov2735_init_reg_list failed!\n", cc_si->name);
		return -ENODEV;
	}
#endif
	ktime_get_ts(&ts_f);

	PRT_INFO("write %s ov2735_init_reg_list finish.\n", cc_si->name);
	PRT_INFO("timeused %d %d\n", (int)(ts_f.tv_sec - ts_s.tv_sec),
		(int)(ts_f.tv_nsec - ts_s.tv_nsec));

	cc_si->reg_bits = 16;
	cc_switch_i2c_dev(cc_si, 0);

	xc7021_bypass_stream(cc_si, 0);

	return ret;
}

static int xc7021_set_ae_target(struct cc_sensor_info *cc_si, int val)
{
	int ret = 0;

	val = val * 4;

	ret += cc_si->write_reg(cc_si, 0xfffd, 0x80);
	ret += cc_si->write_reg(cc_si, 0xfffe, 0x14);
	ret += cc_si->write_reg(cc_si, 0x006c, (val >> 8) & 0xff);
	ret += cc_si->write_reg(cc_si, 0x006d, (val >> 0) & 0xff);

	PRT_DBG("target: 0x%x\n", val);
	return ret;
}

static long sensor_ioctl(struct cc_sensor_info *cc_si, unsigned int cmd,
				void *arg)
{
	int ret = 0;

	switch (cmd) {
	case VIDIOC_ISP_SET_AE_TARGET:
		xc7021_set_ae_target(cc_si, *(unsigned int *) arg);
		break;
	default:
		return -EINVAL;
	}
	return ret;
}

/*
 * ctrl for sensor finish
 */

#define DRIVER_NAME "ov2735_xc7021_dvp"
#define EXT_NAME "ov2735_dvp"


static int sensor_probe(struct platform_device *pdev)
{
	struct cc_sensor_info *cc_si = NULL;
	int ret = 0;

	PRT_INFO("*********probe begin\n");

	cc_si = devm_kzalloc(&pdev->dev, sizeof(*cc_si), GFP_KERNEL);
	if (cc_si == NULL) {
		PRT_ERR("Can't alloc memory!\n");
		return -ENOMEM;
	}

	cc_si->reg_bits = 16;
	cc_si->val_bits = 8;

	cc_si->name = DRIVER_NAME;
	cc_si->ext_name = EXT_NAME;

	cc_si->power_up_act = power_up_act;
	cc_si->power_down_act = power_down_act;
	cc_si->npwr_up_acts = ARRAY_SIZE(power_up_act);
	cc_si->npwr_dn_acts = ARRAY_SIZE(power_down_act);

	cc_si->framefmts = frame_formats;
	cc_si->nfrmfmts = ARRAY_SIZE(frame_formats);

	cc_si->win_sizes = win_sizes;
	cc_si->nwsizes = ARRAY_SIZE(win_sizes);

	cc_si->framecfgs = frame_cfgs;
	cc_si->nfrmcfgs = ARRAY_SIZE(frame_cfgs);

	ret = cc_sensor_probe(pdev, cc_si);
	if (ret < 0)
		return ret;

	cc_si->detect = sensor_detect;
	cc_si->sensor_init = sensor_init;
	cc_si->set_stream = sensor_set_stream;
	cc_si->sensor_ioctl = sensor_ioctl;

	PRT_INFO("probe end\n");
	return 0;
}

static int sensor_remove(struct platform_device *pdev)
{
	struct cc_sensor_info *cc_si = platform_get_drvdata(pdev);

	cc_sensor_remove(pdev);

	devm_kfree(&pdev->dev, cc_si);

	return 0;
}

static const struct of_device_id ov2735_xc7021_dvp_of_match[] = {
	{
		.compatible = DRIVER_NAME,
	},
	{ /* sentinel */ },
};
MODULE_DEVICE_TABLE(of, ov2735_xc7021_dvp_of_match);

static struct platform_driver ov2735_xc7021_dvp_driver = {
	.driver = {
		.of_match_table	= ov2735_xc7021_dvp_of_match,
		.name		= DRIVER_NAME,
		.owner		= THIS_MODULE,
	},
	.probe = sensor_probe,
	.remove = sensor_remove,
};

module_platform_driver(ov2735_xc7021_dvp_driver);

MODULE_DESCRIPTION("OV2735_XC7021-DVP sensor driver");
MODULE_LICENSE("GPL v2");
MODULE_ALIAS("platform:" DRIVER_NAME);

