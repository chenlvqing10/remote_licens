<!DOCTYPE html>
<html>
<head>
 		<meta charset="utf-8">
        <title></title>
        <meta http-equiv="pragma" content="no-cache">
        <meta http-equiv="cache-control" content="no-cache">
</head>
<body>
	<script type="text/javascript">
	
		function pageFilter(data){
			if(typeof data.length=='number' && typeof data.splice=='function'){
				data = {
					total: data.length,
					rows: data
				}
			}
			var dg = $(this);
			var opts = dg.datagrid('options');
			var pager = dg.datagrid('getPager');
			pager.pagination({
				onSelectPage: function(pageNumber, pageSize){
					opts.pageNumber = pageNumber;
					opts.pageSize = pageSize;
					pager.pagination('refresh', {
						pageNumber: pageNumber,
						pageSize: pageSize
					});
					dg.datagrid('loadData', data);
				}
			});
			if(!data.originalRows){
				if(data.rows){
					data.originalRows = data.rows;
				}else if(data.data && data.data.rows){
					data.originalRows = data.data.rows;
				}else{
					data.originalRows = [];
				}
			}
			var start = (opts.pageNumber-1)*parseInt(opts.pageSize);
			var end = start + parseInt(opts.pageSize);
			data.rows = data.originalRows.slice(start, end);
			return data;
		}
		
		function search_member(){
			$.ajax({
				type:'POST',
				url:'/action/searchmember',
				async: false,
				dataType:'json',
				contentType:"application/x-www-form-urlencoded",
				data:{

				},
				success:function(data){
					console.log("search data="+data);
					$('#dg').datagrid({
						data: data,
						loadFilter: pageFilter
					});
				},
				error:function(xhr,status,error){
					alert("查询失败");
				}
			
			
			});
		}

		function delete_member(){
			var employee_number = $('#employee_number').textbox('getValue');
			var name = $('#name').textbox('getValue');
			var role = $("input[name='role']:checked").val();
			var access_right = $("input[name='access_right']:checked").val();
			if(employee_number == "")
				console.log("employee_number == kong");
			if(name == "")
				console.log("name == kong");
			if(role == "")
				console.log("role == kong");
			if(access_right == "")
				console.log("access_right == kong");
			
			
			if(employee_number == "" && name == "" && role == "" && access_right == "") {
				console.log("all == kong, is sure to delete all person?");
				var isok = confirm("是否删除全部注册人员信息?");
				if(isok == false)
					return -1
			}

			$.ajax({
				type:'POST',
				url:'/action/deletemember',
				async: false,
				dataType:'json',
				contentType:"application/x-www-form-urlencoded",
				async:false,
				data:{
					employee_number: employee_number,
					name: name,
					role: role,
					access_right: access_right
				},
				success:function(data){

				},
				error:function(xhr,status,error){
					alert("删除失败");
				}
			
			
			});
		}
		
	</script>
	
	
	<div class="easyui-layout" style="height:643px;">
		<div data-options="region:'north'" style="height:15%;width:100%">
			<div style="padding-left:10px;">
				<label>雇员ID:</label> <input id="employee_number" class="easyui-textbox" value="" style="width:15%;height:30px;" data-options="required:false">
				<label style="padding-left:10px">姓名:</label> <input id="name" class="easyui-textbox" value="" style="width:15%;height:30px;" data-options="required:false">
				<div style="display:inline-block; width:80px; padding-top:10px; padding-left:240px;">
					 <button id="btn1" style="width:80px; height:30px;" onclick="search_member()">查找所有</button> 
				</div>
				<div style="display:inline-block; width:80px; padding-top:10px; padding-left:20px;">
					 <button id="btn2" style="width:80px; height:30px;" onclick="delete_member()">批量删除</button> 
				</div>
			</div>
			<div style="padding-top:10px; padding-left:10px;">
				<label >角色:</label>
				<input type="radio" id="nolist" name="role" checked="true" value=""><label>空</label>
				<input type="radio" id="whitelist" name="role" value="0"><label>0-白名单</label> 
				<input type="radio" id="blacklist" name="role" value="1"><label>1-黑名单</label>  
				<input type="radio" id="commonlist" name="role" value="2"><label>2-普通</label>
				
				<label style="padding-left:30px">访问权限:</label>
				<input type="radio" id="noright" name="access_right" checked="true" value="" onchange=""><label>空</label> 
				<input type="radio" id="permanent" name="access_right" value="0" onchange=""><label>0-永久</label>  
				<input type="radio" id="temporary" name="access_right"  value="1" onchange=""><label>1-临时</label>
				
			</div>
		</div>
		<div data-options="region:'center'" style="height:85%;width:100%">
			<table id="dg" class="easyui-datagrid" data-options="rownumbers:true, singleSelect:true, pagination:true, pageSize:10, autoRowHeight:false, fit:true, pageList:[10,20,50,100]">
				<thead>
					<tr>
						<th field="id" width="10%">ID</th>
						<th field="employee_number" width="10%">雇员ID</th>
						<th field="name" width="10%">姓名</th>
						<th field="role" width="10%">角色</th>
						<th field="access_right" width="20%">访问权限</th>
						<th field="temporary_access_start_time" width="20%">临时访问起始时间</th>
						<th field="temporary_access_end_time" width="20%">临时访问截止时间</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>

	</div>
</body>
</html>
